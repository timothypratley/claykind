<!DOCTYPE html>
<html><head><link href="style.css" rel="stylesheet" type="text/css"><script src="portal-main.js" type="text/javascript"></script><script src="https://scicloj.github.io/scittle/js/scittle.js" type="text/javascript"></script><script src="https://cdn.jsdelivr.net/npm/vega@5" type="text/javascript"></script><script src="https://cdn.jsdelivr.net/npm/vega-lite@5" type="text/javascript"></script><script src="https://cdn.jsdelivr.net/npm/vega-embed@6" type="text/javascript"></script><script src="https://unpkg.com/react@18/umd/react.production.min.js" type="text/javascript"></script><script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" type="text/javascript"></script><script src="https://scicloj.github.io/scittle/js/scittle.reagent.js" type="text/javascript"></script><script type="application/x-scittle">(require '[reagent.core :as r] '[reagent.dom :as dom])
</script></head><body><div><pre><code>(ns kindly.grammars
  (:require [clojure.java.io :as io]
            [malli.core :as ma])
  (:import (javax.imageio ImageIO)))</code></pre></div><div><pre><code></code></pre><div><h1 id="kindly-grammars">Kindly grammars</h1></div></div><div><pre><code></code></pre><div><p>Notebooks and rich REPLs visualize data and objects. Kindly seeks to establish a standard way for users to request visualizations.</p></div></div><div><pre><code></code></pre><div><p>Nesting is an important consideration. For example a table might contain an image in a cell.</p></div></div><div><pre><code></code></pre><div><h2 id="html-(hiccup)">HTML (hiccup)</h2></div></div><div><pre><code></code></pre><div><p>HTML is the most flexible visualization, as you can represent pretty much anything that can display in a browser.</p></div></div><div><pre><code>(def hiccup-table
  ^:kindly/hiccup
  [:table
   [:tr [:td 1] [:td 2]]
   [:tr [:td 3] [:td 4]]])</code></pre></div><div><pre><code></code></pre><div><p>The downside of HTML is that users need to expend considerable effort reshaping their data into views.</p></div></div><div><pre><code></code></pre><div><p>Hiccup has a Malli schema that can be used to validate and parse:</p></div></div><div><pre><code>(def Hiccup
  [:schema {:registry {"hiccup" [:orn
                                 [:node [:catn
                                         [:name keyword?]
                                         [:props [:? [:map-of keyword? any?]]]
                                         [:children [:* [:schema [:ref "hiccup"]]]]]]
                                 [:primitive [:orn
                                              [:nil nil?]
                                              [:boolean boolean?]
                                              [:number number?]
                                              [:text string?]]]]}}
   "hiccup"])</code></pre></div><div><pre><code></code></pre><div><p>Hiccup does not check for the creation of valid HTML; tags and attributes are not checked.</p></div></div><div><pre><code>(def parse-hiccup (ma/parser Hiccup))</code></pre></div><div><pre><code>(parse-hiccup hiccup-table)</code></pre><div class="kind_vector"><div style="border:1px solid grey;padding:2px;">:node</div><div style="border:1px solid grey;padding:2px;"><div class="kind_map"><div style="border:1px solid grey;padding:2px;">:name</div><div style="border:1px solid grey;padding:2px;">:table</div><div style="border:1px solid grey;padding:2px;">:props</div><div style="border:1px solid grey;padding:2px;"></div><div style="border:1px solid grey;padding:2px;">:children</div><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;">:node</div><div style="border:1px solid grey;padding:2px;"><div class="kind_map"><div style="border:1px solid grey;padding:2px;">:name</div><div style="border:1px solid grey;padding:2px;">:tr</div><div style="border:1px solid grey;padding:2px;">:props</div><div style="border:1px solid grey;padding:2px;"></div><div style="border:1px solid grey;padding:2px;">:children</div><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;">:node</div><div style="border:1px solid grey;padding:2px;"><div class="kind_map"><div style="border:1px solid grey;padding:2px;">:name</div><div style="border:1px solid grey;padding:2px;">:td</div><div style="border:1px solid grey;padding:2px;">:props</div><div style="border:1px solid grey;padding:2px;"></div><div style="border:1px solid grey;padding:2px;">:children</div><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;">:primitive</div><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;">:number</div><div style="border:1px solid grey;padding:2px;">1</div></div></div></div></div></div></div></div></div></div></div><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;">:node</div><div style="border:1px solid grey;padding:2px;"><div class="kind_map"><div style="border:1px solid grey;padding:2px;">:name</div><div style="border:1px solid grey;padding:2px;">:td</div><div style="border:1px solid grey;padding:2px;">:props</div><div style="border:1px solid grey;padding:2px;"></div><div style="border:1px solid grey;padding:2px;">:children</div><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;">:primitive</div><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;">:number</div><div style="border:1px solid grey;padding:2px;">2</div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;">:node</div><div style="border:1px solid grey;padding:2px;"><div class="kind_map"><div style="border:1px solid grey;padding:2px;">:name</div><div style="border:1px solid grey;padding:2px;">:tr</div><div style="border:1px solid grey;padding:2px;">:props</div><div style="border:1px solid grey;padding:2px;"></div><div style="border:1px solid grey;padding:2px;">:children</div><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;">:node</div><div style="border:1px solid grey;padding:2px;"><div class="kind_map"><div style="border:1px solid grey;padding:2px;">:name</div><div style="border:1px solid grey;padding:2px;">:td</div><div style="border:1px solid grey;padding:2px;">:props</div><div style="border:1px solid grey;padding:2px;"></div><div style="border:1px solid grey;padding:2px;">:children</div><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;">:primitive</div><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;">:number</div><div style="border:1px solid grey;padding:2px;">3</div></div></div></div></div></div></div></div></div></div></div><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;">:node</div><div style="border:1px solid grey;padding:2px;"><div class="kind_map"><div style="border:1px solid grey;padding:2px;">:name</div><div style="border:1px solid grey;padding:2px;">:td</div><div style="border:1px solid grey;padding:2px;">:props</div><div style="border:1px solid grey;padding:2px;"></div><div style="border:1px solid grey;padding:2px;">:children</div><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;">:primitive</div><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;">:number</div><div style="border:1px solid grey;padding:2px;">4</div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div><pre><code></code></pre><div><h2 id="tables">Tables</h2></div></div><div><pre><code></code></pre><div><p>Tables are interesting because one can imagine users with data in many different shapes; vectors of vectors, vectors of maps, Tablecloth datasets, or maybe something else.</p></div></div><div><pre><code>^:kind/table
{:headers     []
 :row-vectors []}</code></pre><table><thead><tr></tr></thead><tbody></tbody></table></div><div><pre><code>^:kind/table
{:headers     []
 :row-maps []}</code></pre><table><thead><tr></tr></thead><tbody></tbody></table></div><div><pre><code>^:kind/table
[[1 2]
 [3 4]]</code></pre><table><thead><tr></tr></thead><tbody></tbody></table></div><div><pre><code></code></pre><div><p>It would be convenient to allow users several options for table inputs, and some transformations to standardize them for downstream tools. Perhaps this can be achieved with a shorthand helper?</p></div></div><div><pre><code>'(tabulate values)</code></pre><div class="kind_seq"><div style="border:1px solid grey;padding:2px;">tabulate</div><div style="border:1px solid grey;padding:2px;">values</div></div></div><div><pre><code>'(tabulate headers values)</code></pre><div class="kind_seq"><div style="border:1px solid grey;padding:2px;">tabulate</div><div style="border:1px solid grey;padding:2px;">headers</div><div style="border:1px solid grey;padding:2px;">values</div></div></div><div><pre><code></code></pre><div><p>Possibly a multimethod (with a row multimethod as well).</p></div></div><div><pre><code></code></pre><div><p>Tools should be encouraged to accept a standardized data shape defined by a schema:</p></div></div><div><pre><code>(def Table
  [:schema {:registry {"table" ['...]}}
   "table"])</code></pre></div><div><pre><code></code></pre><div><h2 id="plots">Plots</h2></div></div><div><pre><code></code></pre><div><p>Plots have the richest grammar. Two popular grammars for plotting are Vega and ggplot2.</p></div></div><div><pre><code>(defn vega-lite-point-plot [data]
  ^:kind/vega-lite
  {:data {:values data},
   :mark "point"
   :encoding
   {:size {:field "w" :type "quantitative"}
    :x    {:field "x", :type "quantitative"},
    :y    {:field "y", :type "quantitative"},
    :fill {:field "z", :type "nominal"}}})</code></pre></div><div><pre><code>(defn random-data [n]
  (->> (repeatedly n #(- (rand) 0.5))
       (reductions +)
       (map-indexed (fn [x y]
                      {:w (rand-int 9)
                       :z (rand-int 9)
                       :x x
                       :y y}))))</code></pre></div><div><pre><code>(defn random-vega-lite-plot [n]
  (-> n
      random-data
      vega-lite-point-plot))</code></pre></div><div><pre><code>^:kind/vega-lite
(random-vega-lite-plot 9)</code></pre><div style="width:100%;"><script>vegaEmbed(document.currentScript.parentElement, {"encoding":{"y":{"field":"y","type":"quantitative"},"fill":{"field":"z","type":"nominal"},"size":{"field":"w","type":"quantitative"},"x":{"field":"x","type":"quantitative"}},"mark":"point","data":{"values":[{"y":0.3045074742202447,"w":8,"z":1,"x":0},{"y":0.7779371380122749,"w":1,"z":7,"x":1},{"y":0.5605228749255404,"w":5,"z":0,"x":2},{"y":1.0165109116005908,"w":8,"z":2,"x":3},{"y":0.8761316383464764,"w":6,"z":7,"x":4},{"y":0.584446189331561,"w":0,"z":8,"x":5},{"y":0.5446319109118615,"w":3,"z":2,"x":6},{"y":0.1884624121203311,"w":3,"z":5,"x":7},{"y":-0.014879726580853014,"w":1,"z":1,"x":8}]}});</script></div></div><div><pre><code></code></pre><div><p>Vega has json-schemas available which are comprehensive. There is not yet a way to create Malli schemas from Vega json-schema. We could use a json-schema library instead, or improve Malli schema conversion.</p></div></div><div><pre><code></code></pre><div><h2 id="images">Images</h2></div></div><div><pre><code></code></pre><div><p>No grammar is necessary for images.</p></div></div><div><pre><code></code></pre><div><p>Images can be specified using Markdown syntax:</p><pre class="viewer-code not-prose">![a heart](claykind.png)
</pre><figure class="image"><img alt="" src="../../../claykind.png"><figcaption>a heart</figcaption></figure><p>Managing the path to images can be challenging for users.</p></div></div><div><pre><code></code></pre><div><p>It is nice to be able to use "send form to Portal" or similar, can this be done with Markdown?</p></div></div><div><pre><code>(ImageIO/read (io/file "claykind.png"))</code></pre><div>Image kind not implemented</div></div><div><pre><code></code></pre><div><p>Users may benefit from a shorthand helper function <code>(image "claykind.png")</code>.</p></div></div><div><pre><code></code></pre><div><p>sometimes the filename will be calculated programmatically, which would be teadious to achieve with markdown.</p></div></div><div><pre><code></code></pre><div><h2 id="reagent-components">Reagent components</h2></div></div><div><pre><code></code></pre><div><p>A grammar is not possible for functions, or Reagent components.</p></div></div><div><pre><code></code></pre><div><h2 id="tablecloth-datasets">Tablecloth datasets</h2></div></div><div><pre><code></code></pre><div><p>Tablecloth datasets are identifiable by their type.</p></div></div><div><pre><code></code></pre><div><h2 id="markdown">Markdown</h2></div></div><div><pre><code></code></pre><div><p>Markdown comes in different flavours, for example GitHub Markdown and Quarto (qmd). Downstream tools may benefit from a hint as to which flavor should be used. Users probably don't want to have to think too much about this though.</p></div></div><div><pre><code></code></pre><div><p>Of particular interest is the display of mathematical equations, which often require plugin support.</p></div></div><div><pre><code></code></pre><div><p>$ f(x) = x^2 $</p></div></div><div><pre><code></code></pre><div><p>Should render as an equation.</p></div></div><div><pre><code></code></pre><div><p>Somewhat surprisingly, we cannot rely entirely on comments to represent Markdown. We might need to construct Markdown programmatically.</p></div></div><div><pre><code>^:kindly/markdown
(str "## This... is... " :Markdown)</code></pre>## This... is... :Markdown</div><div><pre><code></code></pre><div><h2 id="data">Data</h2></div></div><div><pre><code></code></pre><div><p>No grammar is necessary for primitives and collections.</p></div></div><div><pre><code>{:this #{"is"}
 'data [1 2 3 nil]}</code></pre><div class="kind_map"><div style="border:1px solid grey;padding:2px;">:this</div><div style="border:1px solid grey;padding:2px;"><div class="kind_set"><div style="border:1px solid grey;padding:2px;">is</div></div></div><div style="border:1px solid grey;padding:2px;">data</div><div style="border:1px solid grey;padding:2px;"><div class="kind_vector"><div style="border:1px solid grey;padding:2px;">1</div><div style="border:1px solid grey;padding:2px;">2</div><div style="border:1px solid grey;padding:2px;">3</div><div style="border:1px solid grey;padding:2px;"></div></div></div></div></div><div><pre><code></code></pre><div><p>One challenge is when the data is very large. Ideally some preview would be available.</p></div></div></body></html>